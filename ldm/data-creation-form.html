<!DOCTYPE html>
<meta charset="utf-8">
<title>語学ドリルメーカー用データ作成フォーム</title>
<style>
  * {
    margin: 0;
    box-sizing: border-box;
    font-size: 1rem;
    -webkit-text-size-adjust: none;
    text-size-adjust: none;
  }
  html {
    font-size: 4vmin;
  }
  body {
    padding: 1rem;
    background-color: #ECEFF1;
    font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Segoe UI', YuGothic, 'Yu Gothic Medium', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
  }
  h1 {
    margin: 0 0 1rem 0;
  }
  label {
    font-weight: bold;
  }
  label::after {
    content: ":\00A0";
  }
  input,
  textarea,
  select {
    border: 1px solid gray;
  }
  textarea {
    display: block;
    width: 100%;
    min-width: 100%;
    max-width: 100%;
  }
  input[readonly],
  textarea[readonly] {
    background-color:#ECEFF1;
  }
  button:hover {
    background-image: linear-gradient(#FFF2, #FFF2);
  }
  [class$="-tag"] {
    font-size: .75rem;
  }
  [class$="-tag"]::before {
    content: "[";
  }
  [class$="-tag"]::after {
    content: "]";
  }
  .red-tag {
    color: #C62828;
  }
  .gray-tag {
    color: #757575;
  }
  [id$="-frame"] {
    margin-top: 1rem;
    border: 4px solid var(--frame-color);
  }
  [id$="-frame"] button {
    border-width: 0;
    background-color: var(--frame-color);
    color: #EFEFEF;
  }
  [id$="-frame"] > h2 {
    padding: .25rem 1rem;
    background-color: var(--frame-color);
    color: #EFEFEF;
  }
  [id$="-frame"] > div {
    padding: .5rem 1rem;
  }
  #import-frame {
    --frame-color: #2E7D32;
  }
  #edit-frame {
    --frame-color: #D84315;
  }
  #export-frame {
    --frame-color: #1565C0;
  }
</style>
<h1>語学ドリルメーカー用データ作成フォーム</h1>
<div id="import-frame">
  <h2>既存データの取り込み</h2>
  <div>
    <label for="import-data-type">取り込み元データ</label>
    <select id="import-data-type">
      <option value="none">なし</option>
      <option value="url">URL</option>
      <option value="jsonp">JSONP</option>
      <option value="sample-data">サンプルデータ</option>
    </select>
  </div>
  <div id="import-url-text-wrapper">
    <label for="import-url-text">URL</label>
    <textarea id="import-url-text" rows="4"></textarea>
  </div>
  <div id="import-jsonp-text-wrapper">
    <label for="import-jsonp-text">JSONP</label>
    <textarea id="import-jsonp-text" rows="4"></textarea>
  </div>
  <div id="import-data-button-wrapper">
    <button id="import-data-button">取り込み</button>
  </div>
</div>
<div id="edit-frame">
  <h2>ソースコードの編集</h2>
  <div>
    <label for="qlang-text">問題の言語（qlang）<span class="red-tag">必須</span></label>
    <input id="qlang-text" autocomplete="on" list="langs" required>
    <datalist id="langs">
      <option value="ja">ja: 日本語</option>
      <option value="en">en: 英語</option>
      <option value="en-US">en-US: 英語（アメリカ）</option>
      <option value="en-GB">en-GB: 英語（イギリス）</option>
      <option value="es">es: スペイン語</option>
      <option value="de">de: ドイツ語</option>
      <option value="fr">fr: フランス語</option>
      <option value="it">it: イタリア語</option>
      <option value="ko">ko: 韓国語</option>
      <option value="ru">ru: ロシア語</option>
      <option value="zh">zh: 中国語</option>
    </datalist>
  </div>
  <div>
    <label for="qtemp-text">問題のテンプレート（qtemp）<span class="red-tag">必須</span></label>
    <textarea id="qtemp-text" rows="4" required></textarea>
  </div>
  <div>
    <label for="alang-text">答えの言語（alang）<span class="red-tag">必須</span></label>
    <input id="alang-text" autocomplete="on" list="langs" required>
  </div>
  <div>
    <label for="atemp-text">答えのテンプレート（atemp）<span class="red-tag">必須</span></label>
    <textarea id="atemp-text" rows="4" required></textarea>
  </div>
  <div>
    <label for="ltext">リード文（ltext）<span class="gray-tag">任意</span></label>
    <textarea id="ltext-text" rows="4" required></textarea>
  </div>
</div>
<div id="export-frame">
  <h2>データの書き出し</h2>
  <div>
    <label for="export-data-type">出力タイプ</label>
    <select id="export-data-type">
      <option value="url">URL</option>
      <option value="jsonp">JSONP</option>
    </select>
  </div>
  <div id="export-url-text-wrapper">
    <label for="export-url-text">URL</label>
    <textarea id="export-url-text" rows="4" readonly></textarea>
    <label for="export-url-length">文字数</label>
    <input id="export-url-length" readonly>
  </div>
  <div id="export-jsonp-text-wrapper">
    <label for="export-jsonp-text">JSONP</label>
    <textarea id="export-jsonp-text" rows="4" readonly></textarea>
  </div>
  <div id="copy-button-wrapper">
    <button id="copy-button">クリップボードにコピー</button>
  </div>
</div>
<script>
  const sampleData = {
    "qlang": "ja",
    "qtemp": "[1:私,あなた,彼,彼女,私たち,あなたたち,[彼ら,彼女ら]]は何か[食べる,飲む,読む,書くための,遊ぶための]もの[2:が欲しい,が必要だ,を見つける,を手に入れる,を用意する]。",
    "alang": "en",
    "atemp": "[1:I,You,He,She,We,You,They] [2:want,need,find,get,prepare][[1:,,s,s,,,]] something to [3:eat,drink,read,write with,play with].",
    "ltext": "\"something to do\"の表現を使った英文を練習してみましょう。"
  };
  const urlTextPlaceholder = (() => {
    const f = encodeURIComponent;
    return `https://shikaku1068.github.io/ldm/?qlang=${f(sampleData.qlang)}&qtemp=${f(sampleData.qtemp)}&alang=${f(sampleData.alang)}&atemp=${f(sampleData.atemp)}&ltext=${f(sampleData.ltext)}`;
  })();
  document.querySelector('#import-url-text').placeholder = urlTextPlaceholder;
  const jsonpTextPlaceholder = (() => {
    const f = s => s.replace(/"/g, '\\"');
    return `jsonpCallback {\n  "qlang": "${f(sampleData.qlang)}",\n  "qtemp": "${f(sampleData.qtemp)}",\n  "alang": "${f(sampleData.alang)}",\n  "atemp": "${f(sampleData.atemp)}",\n  "ltext": "${f(sampleData.ltext)}"\n}\n`;
  })();
  document.querySelector('#import-jsonp-text').placeholder = jsonpTextPlaceholder;
  const importDataTypeOnChange = () => {
    const importDataType = document.querySelector('#import-data-type');
    const importUrlTextWrapper = document.querySelector('#import-url-text-wrapper');
    const importJsonpTextWrapper = document.querySelector('#import-jsonp-text-wrapper');
    const importDataButtonWrapper = document.querySelector('#import-data-button-wrapper');
    switch (importDataType.selectedIndex) {
      case 0:
        importUrlTextWrapper.style.display = 'none';
        importJsonpTextWrapper.style.display = 'none';
        importDataButtonWrapper.style.display = 'none';
        break;
      case 1:
        importUrlTextWrapper.style.display = 'block';
        importJsonpTextWrapper.style.display = 'none';
        importDataButtonWrapper.style.display = 'block';
        break;
      case 2:
        importUrlTextWrapper.style.display = 'none';
        importJsonpTextWrapper.style.display = 'block';
        importDataButtonWrapper.style.display = 'block';
        break;
      case 3:
        importUrlTextWrapper.style.display = 'none';
        importJsonpTextWrapper.style.display = 'none';
        importDataButtonWrapper.style.display = 'block';
        break;
    }
  };
  document.querySelector('#import-data-type').addEventListener('change', importDataTypeOnChange);
  importDataTypeOnChange();
  const exportDataTypeOnChange = () => {
    const exportDataType = document.querySelector('#export-data-type');
    const exportUrlTextWrapper = document.querySelector('#export-url-text-wrapper');
    const exportJsonpTextWrapper = document.querySelector('#export-jsonp-text-wrapper');
    const copyButtonWrapper = document.querySelector('#copy-button-wrapper');
    switch (exportDataType.selectedIndex) {
      case 0:
        exportUrlTextWrapper.style.display = 'block';
        exportJsonpTextWrapper.style.display = 'none';
        copyButtonWrapper.style.display = 'block';
        break;
      case 1:
        exportUrlTextWrapper.style.display = 'none';
        exportJsonpTextWrapper.style.display = 'block';
        copyButtonWrapper.style.display = 'block';
        break;
    }
  };
  document.querySelector('#qlang-text').placeholder = sampleData.qlang;
  document.querySelector('#qtemp-text').placeholder = sampleData.qtemp;
  document.querySelector('#alang-text').placeholder = sampleData.alang;
  document.querySelector('#atemp-text').placeholder = sampleData.atemp;
  document.querySelector('#ltext-text').placeholder = sampleData.ltext;
  document.querySelector('#export-data-type').addEventListener('change', exportDataTypeOnChange);
  exportDataTypeOnChange();
  const exportData = () => {
    const baseUrl = 'https://shikaku1068.github.io/ldm/';
    const qlang = document.querySelector('#qlang-text').value.trim();
    const qtemp = document.querySelector('#qtemp-text').value.trim();
    const alang = document.querySelector('#alang-text').value.trim();
    const atemp = document.querySelector('#atemp-text').value.trim();
    const ltext = document.querySelector('#ltext-text').value.trim();
    const exportUrl = (() => {
      const f = encodeURIComponent;
      return `${baseUrl}?qlang=${f(qlang)}&qtemp=${f(qtemp)}&alang=${f(alang)}&atemp=${f(atemp)}&ltext=${f(ltext)}`;
    })();
    document.querySelector('#export-url-text').value = exportUrl;
    document.querySelector('#export-url-length').value = exportUrl.length;
    const exportJsonp = (() => {
      const f = s => s.replace(/"/g, '\\"');
      return `jsonpCallback {\n  "alang": "${f(alang)}",\n  "atemp": "${f(atemp)}",\n  "qlang": "${f(qlang)}",\n  "atemp": "${f(qtemp)}",\n  "ltext": "${f(ltext)}"\n}\n`;
    })();
    document.querySelector('#export-jsonp-text').value = exportJsonp;
  };
  document.querySelectorAll('#qlang-text, #qtemp-text, #alang-text, #atemp-text, #ltext-text').forEach(element => {
    element.addEventListener('input', exportData);
    element.addEventListener('change', exportData);
  });
  document.querySelector('#import-data-button').addEventListener('click', event => {
    const ret = window.confirm('現在の入力内容を消去します。');
    if (! ret) {
      return;
    }
    document.querySelector('#alang-text').value = sampleData.alang;
    document.querySelector('#atemp-text').value = sampleData.atemp;
    document.querySelector('#qlang-text').value = sampleData.qlang;
    document.querySelector('#qtemp-text').value = sampleData.qtemp;
    document.querySelector('#ltext-text').value = sampleData.ltext;
    exportData();
  });
  exportData();
</script>
